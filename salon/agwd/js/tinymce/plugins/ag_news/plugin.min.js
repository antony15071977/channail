

tinymce.PluginManager.add('ag_news', function(editor, url) {
  // Add a button that opens a window
  
var agww = document.body.clientWidth;
var agwh = $(window).height();

if (agww < 1000) {
	   agww = agww*90/100;
	   agwh = agwh*80/100;
} else {
	   agww = agww*50/100;
	   agwh = agwh*50/100;
}
  
  editor.addButton('ag_news', {
    text: ' Новость/Релиз',
    icon: ' icon-newspaper-2',
	title: 'Шаблон Новость/Релиз',
    onclick: function() {
      // Open window
      editor.windowManager.open({
		
	   
        
       
		width: agww,
        height: agwh,
		
         title: 'Шаблон Новость/Релиз',
        body: [
          {type: 'filepicker', name: 'img', label: 'Изображение:'},
		  {type: 'textbox', name: 'content', label: 'Текст:', multiline: true, style: 'height:120px'},
	  
	      //{name:"target",type:"listbox",label:"Режим",values:([{text:"None",value:""},{text:"New window",value:' target="_blank"'}])}
		 
		  
        ],
        onsubmit: function(e) {
          // Insert content when the window form is submitted
		  if (e.data.content) {
			  e.data.content = e.data.content.replace(/(?:\r\n|\r|\n)/g, '</p><p>');
		  }
          editor.insertContent('<div><a href="' + e.data.img + '"><img src="' + e.data.img + '" style="width:400px; float:left;" /></a></div><p>' + e.data.content + '</p><div class="ag_clear">&nbsp;</div><p>&nbsp;</p>');
        }
		
      });
    }
  });

  // Adds a menu item to the tools menu
  
});